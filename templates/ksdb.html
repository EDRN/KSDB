{% extends 'base.html' %}

{% block content %}
    
    {% load staticfiles %}
    <script>
        $(document).ready(function() {
            function changeTab(ele){
                var currentAttrValue = ele.attr('href');
                // Show/Hide Tabs
                $(currentAttrValue).siblings().hide();
                $(currentAttrValue).show();

                // Change/remove current tab to active
                ele.parent('li').addClass('active').siblings().removeClass('active');
            }
            $('#protocol_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/protocolview/"
            });
            $('#person_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/personview/"
            });
            $('#program_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/programview/"
            });
            $('#group_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/groupview/"
            });
            $('#organ_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/organview/"
            });
            $('#disease_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/diseaseview/"
            });
            $('#degree_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/degreeview/"
            });
            $('#institution_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/institutionview/"
            });
            $('#fundedsite_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/fundedsiteview/"
            });
            $('#publication_table').dataTable({
                "processing": true,
                "serverSide": true,
                "ajax": "/ksdb/publicationview/"
            });
            $('.nav li a').on('click', function(e) {
                changeTab($(this));
                e.preventDefault();
            });
            changeTab($('#programtab'));
            {% if request.GET.tabpage %}
                changeTab($('#'+{{request.GET.tabpage}}.getAttribute("id")+"tab"));
            {% endif %}

        });
        function deleteObj(obj,deleteapi){
           var objs  = $.map($(':checkbox[name='+obj+']:checked'), function(n, i){
              return n.id;
           }).join(',');
           if(confirm("Are you sure you want to delete "+obj+": "+objs+"?")) {
               $.ajax({
                url : "/ksdb/"+deleteapi+"/",
                type : 'POST',
                data : $('#viewform').serialize()+"&id="+objs,
                success : function (response) {
                    if(response.Success){
                      alert(response.Message);
                      window.location = '/ksdb/view/?tabpage='+obj;
                    }else{
                      alert("Delete failed because:"+response.Message);
                    }
                },
                error : function(xhr, status, error) {
                    alert("Error: "+xhr.responseText);
                }
              }); 
            }
        }
        
    </script>
    <div class="container">
        <div class="col-md-12 text-center">
                    <H2>Welcome to KSDB!</H2>
                    <p>
                        Knowledge System DB: The goal of this system is to maintain generalized program information to be used for any bioinformatics knowledge system that the JPL Informatics Center supports. For example, EDRN or MCL.
                    </p>
                    <br>
                </div>
                <div class="row"></div>

        <div class="col-12 col-sm-12 col-lg-12">
            <ul class="nav nav-tabs" id="myTab">
                <li class="active"><a id="programtab" href="#program">Programs</a>
                </li>
                <li><a id="institutiontab" href="#institution">Institutions</a>
                </li>
                <li><a id="fundedsitetab" href="#fundedsite">Participating Sites</a>
                </li>
                <li><a id="grouptab" href="#group">Collaborative Group</a>
                </li>
                <li><a id="persontab" href="#person">Personnel</a>
                </li>
                <li><a id="protocoltab" href="#protocol">Protocols</a>
                </li>
                <li><a id="publicationtab" href="#publication">Publications</a>
                </li>
                <li><a id="organtab" href="#organ">Organs</a>
                </li>
                <li><a id="diseasetab" href="#disease">Diseases</a>
                </li>
                <li><a id="degreetab" href="#degree">Degrees</a>
                </li>
                <li><a id="rdftab" href="#rdf">KSDB RDFs</a>
                </li>
            </ul>
        </div>
        <div id="content" class="tab-content">
            <form id="viewform">
                {% csrf_token %} 
                <div class="tab-pane" id="protocol">
                    {% include "protocolview.html" %} 
                </div>
                <div class="tab-pane active" id="program">
                    {% include "programview.html" %} 
                </div>
                <div class="tab-pane" id="person">
                    {% include "personview.html" %} 
                </div>
                <div class="tab-pane" id="institution">
                    {% include "institutionview.html" %} 
                </div>
                <div class="tab-pane" id="group">
                    {% include "groupview.html" %} 
                </div>
                <div class="tab-pane" id="fundedsite">
                    {% include "fundedsiteview.html" %} 
                </div>
                <div class="tab-pane" id="publication">
                    {% include "publicationview.html" %} 
                </div>
                <div class="tab-pane" id="disease">
                    {% include "diseaseview.html" %} 
                </div>
                <div class="tab-pane" id="organ">
                    {% include "organview.html" %} 
                </div>
                <div class="tab-pane" id="degree">
                    {% include "degreeview.html" %} 
                </div>
                <div class="tab-pane" id="rdf">
                    {% include "rdfview.html" %} 
            </div>
            </form>
        </div>
    </div>
{% endblock %}
